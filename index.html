<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø­Ø±Ø¨ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ - Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ âš”ï¸</title>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #1a1a2e; --gold: #f1c40f; --shield: #3498db; --danger: #e74c3c; --panel: #16213e; }
        
        body { 
            font-family: sans-serif; background: var(--bg); color: white; margin: 0; 
            overflow: hidden; display: flex; height: 100vh; width: 100vw; 
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ (Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨) */
        aside#sidebar {
            width: 200px; background: var(--panel); border-left: 2px solid #0f3460;
            display: flex; flex-direction: column; padding: 10px; box-sizing: border-box;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ (Ø§Ù„ÙˆØ³Ø·) */
        main#gameArea {
            flex-grow: 1; position: relative; background: #1b262c;
            overflow: hidden; touch-action: none;
            background-image: radial-gradient(#243447 1px, transparent 1px);
            background-size: 30px 30px;
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„ÙŠØ³Ø±Ù‰ (Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†) */
        aside#leaderboard {
            width: 250px; background: var(--panel); border-right: 2px solid #0f3460;
            display: flex; flex-direction: column; padding: 10px; box-sizing: border-box;
        }

        .stat-card {
            background: #0f3460; padding: 10px; border-radius: 8px; margin-bottom: 10px;
            text-align: center; border: 1px solid #1a1a2e;
        }
        .stat-card span { color: var(--gold); font-size: 1.2rem; font-weight: bold; display: block; }

        .resource {
            width: 40px; height: 40px; position: absolute; border-radius: 50%;
            background: var(--gold); box-shadow: 0 0 15px var(--gold);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; cursor: pointer; z-index: 10;
            transition: transform 0.1s;
        }
        .resource:active { transform: scale(0.9); }

        #playersContainer { flex-grow: 1; overflow-y: auto; }
        .player-row {
            background: #1b262c; margin-bottom: 5px; padding: 8px;
            border-radius: 5px; display: flex; flex-direction: column; gap: 5px;
        }
        .player-info { display: flex; justify-content: space-between; font-size: 0.8rem; }
        
        .attack-btn {
            background: var(--danger); color: white; border: none; padding: 5px;
            border-radius: 4px; font-weight: bold; cursor: pointer; width: 100%;
        }
        .attack-btn:disabled { background: #444; }

        .shield-btn {
            background: var(--shield); color: white; border: none; padding: 12px;
            border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: auto;
        }

        /* Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ ÙˆØ¶Ø¹ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø´ÙƒÙ„ Ø¹Ù…ÙˆØ¯ÙŠ */
        @media screen and (orientation: portrait) {
            #portrait-warning { display: flex !important; }
        }
        #portrait-warning {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 9999; display: none;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
    </style>
</head>
<body>

<div id="portrait-warning">
    <h2>ğŸ”„ ÙŠØ±Ø¬Ù‰ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù‡Ø§ØªÙ</h2>
    <p>Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØµÙ…Ù…Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ ÙÙ‚Ø·</p>
</div>

<aside id="sidebar">
    <div class="stat-card">Ø°Ù‡Ø¨Ùƒ<span id="myScore">0</span></div>
    <div class="stat-card">Ø§Ù„Ø¯Ø±Ø¹<span id="shieldText">ØºÙŠØ± Ù†Ø´Ø·</span></div>
    <div class="stat-card">Ø§Ù„Ù‡Ø¬ÙˆÙ…<span id="cooldown">Ø¬Ø§Ù‡Ø²</span></div>
    <button class="shield-btn" onclick="buyShield()">Ø´Ø±Ø§Ø¡ Ø¯Ø±Ø¹ ğŸ›¡ï¸</button>
</aside>

<main id="gameArea"></main>

<aside id="leaderboard">
    <h4 style="margin: 0 0 10px 0; text-align: center; color: #aaa;">Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ† ğŸ†</h4>
    <div id="playersContainer"></div>
</aside>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAbYbcjdLAEfqIPyrdHq1ZIqjqumDVjhmI",
        authDomain: "barqnet-2a561.firebaseapp.com",
        databaseURL: "https://barqnet-2a561-default-rtdb.firebaseio.com",
        projectId: "barqnet-2a561",
        storageBucket: "barqnet-2a561.firebasestorage.app",
        messagingSenderId: "53556699186",
        appId: "1:53556699186:web:c9e2b60d81979c18841c2b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const playerName = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:") || "Ù„Ø§Ø¹Ø¨_" + Math.floor(Math.random()*1000);
    const playerRef = db.ref('players/' + playerName);
    let myLocalScore = 0;
    let attackCooldown = 0;

    playerRef.set({ name: playerName, score: 0, shieldUntil: 0 });
    playerRef.onDisconnect().remove();

    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙŠ
    playerRef.on('value', snap => {
        const data = snap.val();
        if (data) {
            myLocalScore = data.score || 0;
            document.getElementById('myScore').textContent = myLocalScore;
            const now = Date.now();
            if (data.shieldUntil > now) {
                const rem = Math.ceil((data.shieldUntil - now) / 1000);
                document.getElementById('shieldText').textContent = Math.floor(rem/60) + ":" + (rem%60).toString().padStart(2,'0');
            } else { document.getElementById('shieldText').textContent = "ØºÙŠØ± Ù†Ø´Ø·"; }
        }
    });

    // Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    db.ref('map').on('child_added', snap => {
        const d = snap.val();
        const res = document.createElement('div');
        res.className = 'resource'; res.id = snap.key; res.innerHTML = 'ğŸ’°';
        res.style.left = d.x + "%"; res.style.top = d.y + "%";
        res.onclick = () => {
            playerRef.child('score').transaction(s => (s || 0) + 15);
            db.ref('map/' + snap.key).remove();
        };
        document.getElementById('gameArea').appendChild(res);
    });

    db.ref('map').on('child_removed', snap => {
        const el = document.getElementById(snap.key);
        if (el) el.remove();
    });

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    setInterval(() => {
        db.ref('map').once('value', snap => {
            if (snap.numChildren() < 12) {
                db.ref('map').push({ x: Math.random()*90 + 5, y: Math.random()*90 + 5 });
            }
        });
    }, 3000);

    // Ø§Ù„Ù‡Ø¬ÙˆÙ…
    function attackPlayer(tName) {
        if (attackCooldown > 0) return;
        const tRef = db.ref('players/' + tName);
        tRef.get().then(snap => {
            const t = snap.val();
            if (!t || (t.shieldUntil > Date.now())) return alert("Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø­Ù…ÙŠ!");
            if (t.score > myLocalScore) {
                playerRef.child('score').transaction(s => Math.max(0, s - 30));
                tRef.child('score').transaction(s => (s || 0) + 30);
            } else {
                const loot = Math.floor((t.score || 0) * 0.2);
                playerRef.child('score').transaction(s => (s || 0) + loot);
                tRef.child('score').transaction(s => Math.max(0, s - loot));
            }
            attackCooldown = 600; startCooldown();
        });
    }

    function startCooldown() {
        const itv = setInterval(() => {
            if (attackCooldown > 0) {
                attackCooldown--;
                document.getElementById('cooldown').textContent = Math.floor(attackCooldown/60) + ":" + (attackCooldown%60).toString().padStart(2,'0');
            } else { document.getElementById('cooldown').textContent = "Ø¬Ø§Ù‡Ø²"; clearInterval(itv); }
        }, 1000);
    }

    function buyShield() {
        if (myLocalScore >= 100) {
            playerRef.child('score').transaction(s => s - 100);
            playerRef.child('shieldUntil').set(Date.now() + 600000);
        }
    }

    // Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†
    db.ref('players').orderByChild('score').limitToLast(10).on('value', snap => {
        const cont = document.getElementById('playersContainer');
        cont.innerHTML = '';
        const list = [];
        snap.forEach(c => { list.push({key: c.key, ...c.val()}); });
        list.reverse().forEach(p => {
            if (p.key === playerName) return;
            const isS = p.shieldUntil > Date.now();
            const div = document.createElement('div');
            div.className = 'player-row';
            div.innerHTML = `
                <div class="player-info">
                    <span>${p.name || p.key}</span>
                    <span>ğŸ’° ${p.score || 0}</span>
                </div>
                <button class="attack-btn" ${isS || attackCooldown > 0 ? 'disabled' : ''} 
                    onclick="attackPlayer('${p.key}')">${isS ? 'Ù…Ø­Ù…ÙŠ ğŸ›¡ï¸' : 'Ù‡Ø¬ÙˆÙ… âš”ï¸'}</button>
            `;
            cont.appendChild(div);
        });
    });
</script>
</body>
</html>
